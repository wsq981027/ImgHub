<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>首页</title>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/vue.js"></script>
    <script src="js/jquery-3.3.1.js"></script>
    <script src="js/bootstrap.min.js"></script>

</head>
<style>
    img{
        width: 242px;
        height: 200px;
        margin-right: 10px;
        object-fit: cover;
    }
</style>
<body>
<!--导航栏-->
<nav class="navbar navbar-default">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="index.html">首页</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">
                <li><a href="#">当前类型:</a></li>
                <li><a href="#" id="typename">篮球</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">图片类型 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="types">

                    </ul>
                </li>
            </ul>
            <div action="#" class="navbar-form navbar-left">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search" id="search">
                </div>
                <button class="btn btn-default" onclick="mySearch()">搜索</button>
            </div>
            <ul class="nav navbar-nav navbar-right">
                <li id="userpic"></li>
                <li style="border-right:1px solid silver;"><a href="#">用户名:</a></li>
                <li ><a href="#" id="name1" onclick="gotoMySelf()">请登录</a></li>
                <!--<li class="dropdown">-->
                    <!--<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Dropdown <span class="caret"></span></a>-->
                    <!--<ul class="dropdown-menu">-->
                        <!--<li><a href="#">Action</a></li>-->
                        <!--<li><a href="#">Another action</a></li>-->
                        <!--<li><a href="#">Something else here</a></li>-->
                        <!--<li role="separator" class="divider"></li>-->
                        <!--<li><a href="#">Separated link</a></li>-->
                    <!--</ul>-->
                <!--</li>-->
                <li id="regBtn1">
                    <button  class="btn btn-default" data-toggle="modal" data-target="#regModal">注册</button>
                </li>
                <li id="logBtn1">
                    <button  class="btn btn-default" data-toggle="modal" data-target="#logModal">登录</button>
                </li>
            </ul>
        </div><!-- /.navbar-collapse -->
    </div><!-- /.container-fluid -->
</nav>


<!--放主页图片的容器-->
<div class="row">
    <div class="col-md-9" role="main" style="border-right:1px solid silver;">
        <div class="row" id="imgs">


        </div>
        <hr>
        <div style="text-align: center;">
            <nav aria-label="Page navigation">
                <ul class="pagination pagination-lg">
                    <li>
                        <a href="#" aria-label="Previous" onclick="" id="skippre">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                    <li><a id="skip1" href="#" onclick="">1</a></li>
                    <li><a id="skip2" href="#" onclick="">2</a></li>
                    <li><a id="skip3" href="#" onclick="">3</a></li>
                    <li><a id="skip4" href="#" onclick="">4</a></li>
                    <li><a id="skip5" href="#" onclick="">5</a></li>
                    <li>
                        <a id="skipnex" href="#" aria-label="Next" onclick="">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                </ul>
            </nav>
            <h4>当前页数<span class="label label-default" id="curpage"></span></h4>
        </div>
        <div style="text-align: center;"><a href="#" onclick="gotoAdmin()">Admin</a></div>
        <div style="text-align: center;"><span>官方邮箱: wsq981027@163.com</span></div>
</div>

    <!--上传图片-->
    <div class="col-md-3" role="complementary">
        <div class="form-horizontal" style="border-bottom: 1px solid silver">
            <div class="form-group">
                <label for="pic" class="col-sm-2 control-label">标题</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="title" name="title">
                </div>
            </div>
            <div class="form-group">
                <label for="pic" class="col-sm-2 control-label">简介</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="intro" name="intro">
                </div>
            </div>
            <div class="form-group">
                <label for="imgtypes" class="col-sm-2 control-label">类型</label>
                <div class="col-sm-10">
                    <select class="form-control" id="imgtypes">

                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="pic" class="col-sm-2 control-label">图片</label>
                <div class="col-sm-10">
                    <input type="file" class="form-control" id="pic" name="pic">
                </div>
            </div>
            <div class="form-group">
                <div class="col-sm-offset-2 col-sm-10">
                    <button class="btn btn-default" onclick="upload()">上传</button>
                    <h5>(注:请在登录后上传)</h5>
                </div>
            </div>
        </div>
        <br>
        <h3 style="text-align: center">点赞排行</h3>
        <table id="imgs2" class="table table-hover">

        </table>
    </div>
</div>

<!--模态框-->
<div class="modal fade" id="regModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                注册
            </div>
            <div class="modal-body">
                账号: <input type="text" class="form-control" name="name" id="regName">
                密码：<input type="password" class="form-control" name="password" id="regPass1">
                确认密码: <input type="password" class="form-control" name="password" id="regPass2">
            </div>
            <div class="modal-footer">
                <button id="btn2" class="btn btn-default" onclick="reg()">注册</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="logModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                登录
            </div>
            <div class="modal-body">
                账号: <input type="text" class="form-control" name="name" id="name">
                密码：<input type="password" class="form-control" name="password" id="password">
            </div>
            <div class="modal-footer">
                <button id="btn1" class="btn btn-default" onclick="login()">登录</button>
            </div>
        </div>
    </div>
</div>
</body>
<script type="text/javascript">
    var userid=sessionStorage.getItem('id');
    var points=0;

    $.ajax({
        url:'/hui/TestController/getPoints.do?userid='+userid,
        async:false,
        success:function (datas) {
            console.log('point:'+datas.result.point);
            points=datas.result.point;
        }
    })

    var type='img';
    var search='';
    document.getElementById('skippre').onclick=function () { skip("img",-1); };
    document.getElementById('skipnex').onclick=function () { skip("img",0); };
    document.getElementById('skip1').onclick=function () { skip("img",1); };
    document.getElementById('skip2').onclick=function () { skip("img",2); };
    document.getElementById('skip3').onclick=function () { skip("img",3); };
    document.getElementById('skip4').onclick=function () { skip("img",4); };
    document.getElementById('skip5').onclick=function () { skip("img",5); };


    sessionStorage.setItem('page',1);
    document.getElementById('curpage').innerText=sessionStorage.getItem('page');
    var curtype=2;
    console.log('当前page=',sessionStorage.getItem('page'));
    console.log(sessionStorage.getItem('pic'));
    var name=sessionStorage.getItem('name');
    var userpic=sessionStorage.getItem('pic');
    // alert(userid);
    // console.log('name='+name);
    if(name!='null') {
        document.getElementById('userpic').innerHTML='积分:'+points+'<img class="img-circle" src="/'+userpic+'" alt="" style="width: 50px;height: 50px">';
        document.getElementById('name1').innerText = name;
        document.getElementById('logBtn1').innerHTML='<button class="btn btn-default" onclick="gotoMySelf()">主页</button>';
    }

    var img1='<div class="col-sm-6 col-md-4" style="width: 282px;height: 380px;"><div class="thumbnail"><a href="#"><div style="width: 242px;height: 200px;"><img onclick="getimg(';
    var img2=')" src="/';
    var img3='"></div></a><div class="caption"><h3>';
    var img4='</h3><p>';
    var img5='</p><p><a id="collect';
    var img6='" href="#" class="btn btn-default" role="button" onclick="collect(';
    var img7emp=')"><i class="glyphicon glyphicon-star-empty"></i>收藏</a> <a id="thumb';
    var img7=')"><i class="glyphicon glyphicon-star"></i>已收藏</a> <a id="thumb';
    var img8='" href="#" class="btn btn-default" role="button" onclick="thumb(';
    var img9emp=')"><i class="glyphicon glyphicon-heart-empty">点赞</i>';
    var img9=')"><i class="glyphicon glyphicon-heart">已点赞</i>';
    var img10='</a></p></div></div></div>';

    $.ajax({
        url:'/admin/getTypes.do',
        type:'get',
        contentType: false,
        processData: false,
        success:function (datas) {
            // console.log('获取类型下拉'+datas);
            // console.log('获取类型下拉'+datas.result);
            for (var i=0;i<datas.result.length;i++) {
                if (i==0) {
                    $('#imgtypes').append('<option value="' + datas.result[i]['id'] + '" selected="selected">' + datas.result[i]['name'] + '</option>');
                    $('#types').append('<li><a href="#" onclick="getImgsByType('+datas.result[i]['id']+')">'+datas.result[i]['name']+'</a></li>');
                }
                else{
                    $('#imgtypes').append('<option value="' + datas.result[i]['id'] + '">' + datas.result[i]['name'] + '</option>');
                    $('#types').append('<li><a href="#" onclick="getImgsByType('+datas.result[i]['id']+')">'+datas.result[i]['name']+'</a></li>');
                }
            }
        }
    })

    function gotoMySelf() {
        if (sessionStorage.getItem('id')==null){
            alert('请登录');
            return;
        }
        window.location.href='mine.html';
    }

    function mySearch() {
        document.getElementById('skippre').onclick=function () { skip("search",-1); };
        document.getElementById('skipnex').onclick=function () { skip("search",0); };
        document.getElementById('skip1').onclick=function () { skip("search",1); };
        document.getElementById('skip2').onclick=function () { skip("search",2); };
        document.getElementById('skip3').onclick=function () { skip("search",3); };
        document.getElementById('skip4').onclick=function () { skip("search",4); };
        document.getElementById('skip5').onclick=function () { skip("search",5); };

        sessionStorage.setItem('page',1);
        type='search';
        search=document.getElementById('search').value;
        if (search==''){
            alert('请输入搜索信息');
            return;
        }
        $.ajax({
            url:"/hui/TestController/search.do?name="+search,
            type:"get",
            success:function (datas) {
                console.log("search"+datas.result);
                $('#imgs').empty();
                for (var i=0;i<15;i++) {
                    if (userid!=null) {
                        $.ajax({
                            url: "/hui/TestController/checkThumbAndCollect.do?imgid=" + datas.result[i]['id'] + "&userid=" + userid,
                            type: "post",
                            async:false,
                            contentType: false,
                            processData: false,
                            success: function (data) {
                                if (data.resMsg == '未点赞,未收藏')
                                    $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,已收藏')
                                    $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,未收藏')
                                    $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else
                                    $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                            },
                            error: function (datas) {
                                console.log(datas);
                            }
                        });
                    }else{
                        $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                    }
                }
            }
        })
    }
    function collect(imgid){
        if (userid==null){
            alert('请在登录后收藏');
            return;
        }
        $.ajax({
            url: "/hui/TestController/collect.do?imgid="+imgid+"&userid="+userid,
            type: "post",
            dataType:'json',
            success: function (data) {
                console.log('tetstetst'+data.resMsg);
                if (data.resMsg=="已收藏过")
                    alert('取消收藏成功');
                else {
                    alert('收藏成功');
                }
                skip('img',sessionStorage.getItem('page'));
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function getimg(imgid){
        $.ajax({
            url:"/hui/TestController/getImgById.do?imgid="+imgid,
            type:"get",
            success:function (data) {
                console.log(data);
                $('#imgs').empty();
                $.ajax({
                    url:"/hui/TestController/getUserById.do?userid="+data.result['userid'],
                    type:"get",
                    success:function (userdata) {
                        $.ajax({
                            url:'/hui/TestController/checkPurchase.do?userid='+userid+'&imgid='+data.result.id,
                            success:function (datas) {
                                if (datas.resMsg=='已购买')
                                    $('#imgs').append('<div style="text-align: center;"><img src="/'+data.result['imgname']+'" style="width: 700px;height: 600px"><a href="#" onclick="gotoHimself('+userdata.result['id']+')"><h3>上传人: '+userdata.result['name']+'</h3></a><button class="btn btn-info" onclick="backToMain()">返回</button></div><br><div style="text-align: center;"><a href="#" onclick="purchase('+imgid+')"><button class="btn btn-primary btn-lg active">购买图片(1积分)</button></a><a href="/'+data.result['imgname']+'"download="'+data.result['imgname']+'"><button class="btn btn-primary btn-lg active">下载图片</button></a></div>');
                                else
                                    $('#imgs').append('<div style="text-align: center;"><img src="/'+data.result['imgname']+'" style="width: 700px;height: 600px"><a href="#" onclick="gotoHimself('+userdata.result['id']+')"><h3>上传人: '+userdata.result['name']+'</h3></a><button class="btn btn-info" onclick="backToMain()">返回</button></div><br><div style="text-align: center;"><a href="#" onclick="purchase('+imgid+')"><button class="btn btn-primary btn-lg active">购买图片(1积分)</button></a><a href="#" onclick="ale()"><button class="btn btn-primary btn-lg active">下载图片</button></a></div>');
                            }
                        })
                    },error:function (userdata) {
                        console.log(userdata);
                    }
                })
            },error:function (data) {
                console.log(data);
            }
        })
    }

    function ale() {
        alert('请购买后再下载');
    }

    function purchase(imgid) {
        $.ajax({
            url:'/hui/TestController/purchaseImg.do?userid='+userid+'&imgid='+imgid,
            success:function (datas) {
                alert(datas.resMsg);
                getimg(imgid);
                $.ajax({
                    url:'/hui/TestController/getPoints.do?userid='+userid,
                    async:false,
                    success:function (datas) {
                        console.log('point:'+datas.result.point);
                        points=datas.result.point;
                        document.getElementById('userpic').innerHTML='积分:'+points+'<img class="img-circle" src="/'+userpic+'" alt="" style="width: 50px;height: 50px">';
                    }
                })
            }
        })
    }


    function gotoHimself(goid) {
        sessionStorage.setItem('goid',goid);
        window.location.href='himself.html';
    }

        //右侧表格图片
        $.ajax({
            url: "/hui/TestController/selectAllOrderByThumb.do",
            type: "get",
            contentType: false,
            processData: false,
            success: function (datas) {
                // $('#page').show();
                $('#imgs2').append('<tbody>');
                $('#imgs2').append('<tr> <td>编号</td> <td>类型</td> <td>标题</td><td>图片</td> <td>上传人</td> <td>点赞数</td></tr>');
                for (var i=0;i<9;i++) {
                    var n=parseInt(i)+1;
                    $.ajax({
                        url: "/hui/TestController/getUserById.do?userid=" + datas.result[i]['userid'],
                        type: "get",
                        async: false,
                        success: function (data) {
                            $.ajax({
                                url: "/admin/getTypeById.do?typeid=" + datas.result[i]['typeid'],
                                type: "get",
                                async: false,
                                success: function (datat) {
                                        $('#imgs2').append('<tr><td>' + n + '</td><td>'+datat.result.name+'</td><td>' + datas.result[i]['title'] + '</td><td><a href="#" onclick="getimg('+datas.result[i]['id']+')"><img class="img img-rounded" src="/' + datas.result[i]['imgname'] + '" alt="" style="width: 50px;height: 50px"></a></td><td>' + data.result['name'] + '</td><td>' + datas.result[i]['thumb'] + '</td></tr>');
                                }
                            })
                            $('#imgs2').append('</tbody>');
                        }
                    })
                }
            },
            error: function (datas) {
                console.log(datas);
            }
        });
    function backToMain(){
        skip(type,sessionStorage.getItem('page'));
    }

    // <a href="./images/'+data.result['imgname']+'"download="'+data.result['imgname']+'"></a>

    function getImgsByType(typeid){
        curtype=typeid;
        sessionStorage.setItem('page',1);
        document.getElementById('curpage').innerText=sessionStorage.getItem('page');
        $.ajax({
            url:'/admin/getTypeById.do?typeid='+typeid,
            type:'get',
            success:function (data) {
                document.getElementById('typename').innerText=data.result.name;
            }
        })
        $('#imgs').empty();
        $.ajax({
            url: "/hui/TestController/getImgsByType.do?typeid="+typeid,
            type: "post",
            contentType: false,
            processData: false,
            success: function (datas) {
                console.log(datas);
                for (var i=0;i<15;i++) {

                    if (userid!=null) {
                        $.ajax({
                            url: "/hui/TestController/checkThumbAndCollect.do?imgid=" + datas.result[i]['id'] + "&userid=" + userid,
                            type: "post",
                            async:false,
                            contentType: false,
                            processData: false,
                            success: function (data) {
                                console.log(datas.result[i]['imgname']);
                                if (data.resMsg == '未点赞,未收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,已收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,未收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                            },
                            error: function (datas) {
                                console.log(datas);
                            }
                        });
                    }else{
                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                    }
                }
            },
            error: function (datas) {
                console.log(datas);
            }
        });
    }

    //初次加载页面，默认显示篮球分类图片
    $.ajax({
        url: "/hui/TestController/getImgsByType.do?typeid="+2,
        type: "post",
        contentType: false,
        processData: false,
        success: function (datas) {
            console.log(datas);
            for (var i=0;i<15;i++) {

                if (userid!=null) {
                    $.ajax({
                        url: "/hui/TestController/checkThumbAndCollect.do?imgid=" + datas.result[i]['id'] + "&userid=" + userid,
                        type: "post",
                        async:false,
                        contentType: false,
                        processData: false,
                        success: function (data) {
                                if (data.resMsg == '未点赞,未收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,已收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else if (data.resMsg == '已点赞,未收藏')
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                else
                                    $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                        },
                        error: function (datas) {
                            console.log(datas);
                        }
                    });
                }else{
                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                }
            }
        },
        error: function (datas) {
            console.log(datas);
        }
    });

    function skip(type,flag) {
        if (flag==-1)
            var page=parseInt(sessionStorage.getItem('page'))-1;
        else if (flag==0)
            var page=parseInt(sessionStorage.getItem('page'))+1;
        else
            var page=flag;
        if (page==0)
            page=1;
        sessionStorage.setItem('page',page);
        document.getElementById('curpage').innerText=sessionStorage.getItem('page');
        if (type=='img'){
            $.ajax({
                url: "/hui/TestController/getImgsByType.do?typeid="+curtype,
                type: "post",
                contentType: false,
                processData: false,
                success: function (datas) {
                    console.log(datas);
                    $('#imgs').empty();
                    for (var i=(page-1)*15;i<page*15;i++) {

                        if (userid!=null) {
                            $.ajax({
                                url: "/hui/TestController/checkThumbAndCollect.do?imgid=" + datas.result[i]['id'] + "&userid=" + userid,
                                type: "post",
                                async:false,
                                contentType: false,
                                processData: false,
                                success: function (data) {
                                    if (data.resMsg == '未点赞,未收藏')
                                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                    else if (data.resMsg == '已点赞,已收藏')
                                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                    else if (data.resMsg == '已点赞,未收藏')
                                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                    else
                                        $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                },
                                error: function (datas) {
                                    console.log(datas);
                                }
                            });
                        }else{
                            $('#imgs').append(img1 + datas.result[i]['id'] + img2 + datas.result[i]['imgname'] + img3 + datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                        }
                    }
                },
                error: function (datas) {
                    console.log(datas);
                }
            });
        }
        if (type=='search'){
            $.ajax({
                url:"/hui/TestController/search.do?name="+search,
                type:"get",
                success:function (datas) {
                    console.log("search"+datas.result);
                    $('#imgs').empty();
                    for (var i=(page-1)*10;i<page*10;i++) {
                        if (userid!=null) {
                            $.ajax({
                                url: "/hui/TestController/checkThumbAndCollect.do?imgid=" + datas.result[i]['id'] + "&userid=" + userid,
                                type: "post",
                                async:false,
                                contentType: false,
                                processData: false,
                                success: function (data) {
                                    if (data.resMsg == '未点赞,未收藏')
                                        $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                    else if (data.resMsg == '已点赞,已收藏')
                                        $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                    else if (data.resMsg == '已点赞,未收藏')
                                        $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9 + datas.result[i]['thumb'] + img10);
                                    else
                                        $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7 + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                                },
                                error: function (datas) {
                                    console.log(datas);
                                }
                            });
                        }else{
                            $('#imgs').append(img1+datas.result[i]['id']+img2+ datas.result[i]['imgname']+img3+ datas.result[i]['title'] + img4 + datas.result[i]['intro'] + img5 + datas.result[i]['id'] + img6 + datas.result[i]['id'] + img7emp + datas.result[i]['id'] + img8 + datas.result[i]['id'] + img9emp + datas.result[i]['thumb'] + img10);
                        }
                    }
                }
            })
        }
    }
    function thumb(id) {
        if (userid==null){
            alert('请在登录后点赞');
            return;
        }
        $.ajax({
            url: "/hui/TestController/thumb.do?imgid="+id+"&userid="+userid,
            type: "post",
            success: function (data) {
                console.log(data);
                skip('img',sessionStorage.getItem('page'));
            },
            error: function (data) {
                console.log(data);
            }
        });
    }

    function upload() {
        var pic = document.getElementById("pic").files[0];
        var title = document.getElementById("title").value;
        var intro = document.getElementById("intro").value;
        var type=$('#imgtypes').val();
        if (userid==null){
            alert('请在登录后上传');
            return;
        }
        if (title==''){
            alert('标题不能为空');
            return;
        }
        // console.log(file);
        // alert(title);
        var formData = new FormData();
        formData.append('pic', pic);
        formData.append('title',title);
        formData.append('intro',intro);
        formData.append('userid',userid);
        formData.append('type',type);
        console.log("test"+formData.get('pic'));

        $.ajax({
            url: "/hui/TestController/upload.do",
            type: "post",
            data: formData,
            contentType: false,
            processData: false,
            dataType:'json',
            mimeType: "multipart/form-data",
            success: function (data) {
                console.log(data);
                console.log(data.resMsg);
                if (data.resMsg=='请上传文件')
                    alert('请上传图片');
                else if (data.resMsg=='上传失败')
                    alert('上传失败');
                else
                    alert('上传成功,请等待审核');
                window.location.reload();
            },
            error: function (data) {
                console.log(data);
                alert('上传失败');
            }
        });
    }

    function reg(){
        var name=document.getElementById("regName").value;
        var password=document.getElementById("regPass1").value;
        var password2=document.getElementById("regPass2").value;
        if (password2!=password||password2=='null') {
            alert('两次密码输入不一致');
            return;
        }
        if (password.length<6){
            alert('密码长度必须超过6位');
            return;
        }

        $(document).ready(function() {
            $.ajax({
                url : "hui/TestController/reg.do?name="+name+"&password="+password,//后台请求的数据，用的是PHP
                dataType : "json",//数据格式 
                type : "get",//请求方式
                async : false,//是否异步请求
                success : function(data) {   //如果请求成功，返回数据。
                    if (data.resMsg!="注册成功"){
                        alert(data.resMsg);
                        return;
                    }
                    else {
                        alert("注册成功");
                        window.location.href = "index.html";
                    }
                },
            })
        })
    }

    function login(){
        var name=document.getElementById("name").value;
        var password=document.getElementById("password").value;
        $(document).ready(function() {
            $.ajax({
                url : "hui/TestController/login.do?name="+name+"&password="+password,//后台请求的数据，用的是PHP
                dataType : "json",//数据格式 
                type : "get",//请求方式
                async : false,//是否异步请求
                success : function(data) {   //如果请求成功，返回数据。
                    var html = "";
                    if (data.resMsg=="密码错误"){
                        alert("密码错误");
                        return;
                    }
                    else if (data.resMsg=='封禁账号'){
                        alert('该账户已被封锁');
                        return;
                    }
                    else {
                        alert("登录成功");
                        sessionStorage.setItem("id", data.result.id);
                        sessionStorage.setItem("name", data.result.name);
                        sessionStorage.setItem("pass",data.result.password);
                        sessionStorage.setItem("pic",data.result.pic);
                        window.location.href = "index.html";
                    }
                },
            })
        })
    }

    function gotoAdmin() {
        var adminid=sessionStorage.getItem('adminid');
        if(adminid!=null)
            window.location.href='admin.html';
        else
            window.location.href='adminLog.html';
    }
</script>
</html>